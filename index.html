<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Surat Desa Buareng</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3f4f6;
            margin: 0;
            padding: 20px;
            color: #1f2937;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 20px;
        }

        .header h1 { color: #111827; font-size: 22px; margin: 0; }
        .header p { color: #6b7280; font-size: 14px; margin-top: 5px; }

        .form-section { margin-bottom: 20px; }
        .section-title { font-size: 16px; font-weight: bold; color: #374151; margin-bottom: 10px; border-left: 4px solid #2563eb; padding-left: 10px; }

        label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 6px; color: #374151; }
        
        input, select, textarea {
            width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;
            font-size: 14px; margin-bottom: 15px; box-sizing: border-box; transition: 0.2s;
        }
        input:focus, select:focus, textarea:focus { border-color: #2563eb; outline: none; ring: 2px solid #bfdbfe; }

        /* Kelas untuk menyembunyikan form khusus */
        .hidden { display: none; }

        .btn-submit {
            width: 100%; background-color: #2563eb; color: white; padding: 14px;
            border: none; border-radius: 8px; font-size: 16px; font-weight: 600;
            cursor: pointer; transition: background 0.3s; margin-top: 10px;
        }
        .btn-submit:hover { background-color: #1d4ed8; }

        .note { font-size: 12px; color: #6b7280; text-align: center; margin-top: 15px; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1><i class="fas fa-landmark"></i> Pelayanan Desa Buareng</h1>
        <p>Kecamatan Kajuara, Kabupaten Bone</p>
    </div>

    <form id="suratForm">
        <div class="form-section">
            <label for="jenisSurat">Pilih Jenis Surat:</label>
            <select id="jenisSurat" onchange="toggleForm()">
                <option value="sku">Surat Keterangan Usaha (SKU)</option>
                <option value="sktm">Surat Keterangan Tidak Mampu (SKTM)</option>
                <option value="domisili">Surat Keterangan Domisili</option>
                <option value="pengantar">Surat Pengantar (SKCK/Nikah dll)</option>
                <option value="waris">Surat Keterangan Ahli Waris</option>
            </select>
        </div>

        <div class="form-section">
            <div class="section-title">Data Pemohon</div>
            <label>Nama Lengkap</label>
            <input type="text" id="nama" placeholder="Sesuai KTP" required>
            
            <label>NIK</label>
            <input type="number" id="nik" placeholder="16 digit NIK" required>

            <label>Tempat, Tanggal Lahir</label>
            <input type="text" id="ttl" placeholder="Contoh: Bone, 12 Januari 1990" required>

            <label>Jenis Kelamin</label>
            <select id="jk">
                <option value="Laki-laki">Laki-laki</option>
                <option value="Perempuan">Perempuan</option>
            </select>

            <label>Pekerjaan</label>
            <input type="text" id="pekerjaan" placeholder="Contoh: Petani / Wiraswasta" required>
            
            <label>Agama</label>
            <select id="agama">
                <option value="Islam">Islam</option>
                <option value="Kristen">Kristen</option>
                <option value="Katolik">Katolik</option>
                <option value="Hindu">Hindu</option>
                <option value="Buddha">Buddha</option>
            </select>

            <label>Alamat</label>
            <textarea id="alamat" rows="2" placeholder="Dusun/Lingkungan..." required></textarea>
        </div>

        <div id="form-sku" class="form-section">
            <div class="section-title">Detail Usaha</div>
            <label>Nama Usaha</label>
            <input type="text" id="nama_usaha" placeholder="Contoh: Warung Sembako Ibu Budi">
            <label>Jenis Usaha</label>
            <input type="text" id="jenis_usaha" placeholder="Contoh: Jual Beli Hasil Bumi / Kelontong">
        </div>

        <div id="form-pengantar" class="form-section hidden">
            <div class="section-title">Keperluan Surat</div>
            <label>Tujuan/Keperluan</label>
            <textarea id="keperluan_pengantar" rows="2" placeholder="Contoh: Persyaratan pembuatan SKCK di Polsek Kajuara"></textarea>
        </div>

        <div id="form-sktm" class="form-section hidden">
            <div class="section-title">Keperluan SKTM</div>
            <label>Untuk Keperluan</label>
            <input type="text" id="keperluan_sktm" placeholder="Contoh: Pendaftaran KIP Kuliah / Beasiswa">
            <label>Nama Orang Tua/Wali (Jika untuk anak sekolah)</label>
            <input type="text" id="nama_ortu" placeholder="Kosongkan jika untuk diri sendiri">
        </div>

        <div id="form-waris" class="form-section hidden">
            <div class="section-title">Data Almarhum/Pewaris</div>
            <label>Nama Almarhum</label>
            <input type="text" id="nama_alm" placeholder="Nama Lengkap Almarhum">
            <label>Tanggal Meninggal</label>
            <input type="date" id="tgl_meninggal">
            <label>Umur saat meninggal</label>
            <input type="number" id="umur_alm" placeholder="Tahun">
            <label>Alamat Terakhir Almarhum</label>
            <input type="text" id="alamat_alm">
        </div>

        <button type="button" class="btn-submit" onclick="generatePDF()">
            <i class="fas fa-print"></i> Cetak PDF & Kirim ke Admin
        </button>
        <p class="note">File PDF akan otomatis terunduh. Harap kirimkan file tersebut ke WhatsApp Admin.</p>
    </form>
</div>

<script>
    // --- KONFIGURASI DESA BUARENG ---
    const config = {
        desa: "DESA BUARENG",
        kecamatan: "KECAMATAN KAJUARA",
        kabupaten: "KABUPATEN BONE",
        alamat: "Jl. Poros Bone Sinjai, Kode Pos 92777",
        kades: "IMRAN MAPPEARE, SE",
        nomorWA: "6282319527214" // Ganti Nomor Admin di sini
    };

    // --- URL LOGO BONE (Wikimedia) ---
    const logoUrl = "https://bone.go.id/wp-content/uploads/2019/02/lambang-bone.png";
    let logoBase64 = null;

    // Pre-load Logo agar siap saat print
    function toDataURL(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function() {
            var reader = new FileReader();
            reader.onloadend = function() { callback(reader.result); }
            reader.readAsDataURL(xhr.response);
        };
        xhr.open('GET', url);
        xhr.responseType = 'blob';
        xhr.send();
    }
    toDataURL(logoUrl, function(dataUrl) { logoBase64 = dataUrl; });

    // --- LOGIKA TAMPILAN FORM ---
    function toggleForm() {
        // Sembunyikan semua field khusus dulu
        document.getElementById('form-sku').classList.add('hidden');
        document.getElementById('form-pengantar').classList.add('hidden');
        document.getElementById('form-sktm').classList.add('hidden');
        document.getElementById('form-waris').classList.add('hidden');

        // Tampilkan yang dipilih
        const jenis = document.getElementById('jenisSurat').value;
        if (jenis === 'sku') document.getElementById('form-sku').classList.remove('hidden');
        else if (jenis === 'pengantar') document.getElementById('form-pengantar').classList.remove('hidden');
        else if (jenis === 'sktm') document.getElementById('form-sktm').classList.remove('hidden');
        else if (jenis === 'waris') document.getElementById('form-waris').classList.remove('hidden');
    }

    // --- FUNGSI UTAMA GENERATE PDF ---
    async function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Ambil Data Umum
        const nama = document.getElementById('nama').value.toUpperCase();
        const nik = document.getElementById('nik').value;
        const ttl = document.getElementById('ttl').value;
        const jk = document.getElementById('jk').value;
        const pekerjaan = document.getElementById('pekerjaan').value;
        const agama = document.getElementById('agama').value;
        const alamat = document.getElementById('alamat').value;
        const jenisSurat = document.getElementById('jenisSurat').value;

        // Validasi Sederhana
        if (!nama || !nik) { alert("Mohon lengkapi data diri!"); return; }

        // --- 1. MEMBUAT KOP SURAT (HEADER) ---
        // Logo
        if (logoBase64) {
            doc.addImage(logoBase64, 'PNG', 20, 15, 23, 27); // Posisi Logo
        }
        
        // Teks Kop
        doc.setFont("times", "bold");
        doc.setFontSize(14);
        doc.text("PEMERINTAH KABUPATEN BONE", 115, 20, null, null, "center");
        doc.text("KECAMATAN KAJUARA", 115, 26, null, null, "center");
        doc.setFontSize(18);
        doc.text("DESA BUARENG", 115, 34, null, null, "center");
        doc.setFont("times", "normal");
        doc.setFontSize(11);
        doc.text(config.alamat, 115, 40, null, null, "center");

        // Garis Ganda
        doc.setLineWidth(1);
        doc.line(20, 45, 190, 45);
        doc.setLineWidth(0.5);
        doc.line(20, 46, 190, 46);

        // --- 2. ISI SURAT BERDASARKAN JENIS ---
        let judulSurat = "";
        let nomorSurat = "";
        let isiSurat = "";
        
        // Set Default Font untuk Isi
        doc.setFont("times", "normal");
        doc.setFontSize(12);

        // Variabel Data Diri untuk dicetak (Y Position awal)
        let yPos = 80;
        const lh = 7; // Line Height

        // LOGIKA KONTEN PER SURAT
        if (jenisSurat === 'sku') {
            judulSurat = "SURAT KETERANGAN USAHA";
            nomorSurat = "Nomor: 503 / ... / DB / " + new Date().getFullYear();
            
            const namaUsaha = document.getElementById('nama_usaha').value.toUpperCase();
            const jenisUsaha = document.getElementById('jenis_usaha').value;

            isiSurat = "Yang bertanda tangan di bawah ini Kepala Desa Buareng, Kecamatan Kajuara, Kabupaten Bone menerangkan dengan sebenarnya bahwa:";
            // Data tambahan SKU di bawah data diri nanti
        } 
        else if (jenisSurat === 'sktm') {
            judulSurat = "SURAT KETERANGAN TIDAK MAMPU";
            nomorSurat = "Nomor: 401 / ... / DB / " + new Date().getFullYear();
            isiSurat = "Yang bertanda tangan di bawah ini Kepala Desa Buareng, Kecamatan Kajuara, Kabupaten Bone menerangkan bahwa warga tersebut di bawah ini benar-benar penduduk Desa kami yang tergolong Keluarga Tidak Mampu / Pra Sejahtera.";
        }
        else if (jenisSurat === 'domisili') {
            judulSurat = "SURAT KETERANGAN DOMISILI";
            nomorSurat = "Nomor: 470 / ... / DB / " + new Date().getFullYear();
            isiSurat = "Yang bertanda tangan di bawah ini Kepala Desa Buareng, Kecamatan Kajuara, Kabupaten Bone menerangkan dengan sebenarnya bahwa warga tersebut di bawah ini adalah benar-benar Penduduk yang berdomisili di Desa Buareng.";
        }
        else if (jenisSurat === 'pengantar') {
            judulSurat = "SURAT PENGANTAR";
            nomorSurat = "Nomor: 140 / ... / DB / " + new Date().getFullYear();
            isiSurat = "Yang bertanda tangan di bawah ini Kepala Desa Buareng, Kecamatan Kajuara, Kabupaten Bone menerangkan bahwa:";
        }
        else if (jenisSurat === 'waris') {
            judulSurat = "SURAT KETERANGAN AHLI WARIS";
            nomorSurat = "Nomor: 474 / ... / DB / " + new Date().getFullYear();
            isiSurat = "Yang bertanda tangan di bawah ini Kepala Desa Buareng, Kecamatan Kajuara, Kabupaten Bone menerangkan bahwa:";
        }

        // --- RENDER JUDUL ---
        doc.setFont("times", "bold");
        doc.setFontSize(14);
        doc.text(judulSurat, 105, 55, null, null, "center");
        doc.setLineWidth(0.5);
        doc.line(70, 56, 140, 56); // Garis bawah judul
        doc.setFontSize(12);
        doc.setFont("times", "normal");
        doc.text(nomorSurat, 105, 62, null, null, "center");

        // --- RENDER PEMBUKA ---
        doc.text(isiSurat, 20, 75, {maxWidth: 170, align: "justify"});

        // --- RENDER DATA DIRI PEMOHON ---
        doc.text("Nama Lengkap", 30, yPos); doc.text(`: ${nama}`, 80, yPos);
        yPos += lh;
        doc.text("NIK", 30, yPos); doc.text(`: ${nik}`, 80, yPos);
        yPos += lh;
        doc.text("Tempat/Tgl Lahir", 30, yPos); doc.text(`: ${ttl}`, 80, yPos);
        yPos += lh;
        doc.text("Jenis Kelamin", 30, yPos); doc.text(`: ${jk}`, 80, yPos);
        yPos += lh;
        doc.text("Pekerjaan", 30, yPos); doc.text(`: ${pekerjaan}`, 80, yPos);
        yPos += lh;
        doc.text("Agama", 30, yPos); doc.text(`: ${agama}`, 80, yPos);
        yPos += lh;
        
        // Alamat (Multilines)
        doc.text("Alamat", 30, yPos);
        const alamatSplit = doc.splitTextToSize(`: ${alamat}`, 110);
        doc.text(alamatSplit, 80, yPos);
        yPos += (alamatSplit.length * lh);

        // --- RENDER DATA KHUSUS (BAWAH DATA DIRI) ---
        
        if (jenisSurat === 'sku') {
            yPos += 5;
            doc.text("Benar yang bersangkutan mempunyai usaha:", 20, yPos);
            yPos += lh;
            doc.text("Nama Usaha", 30, yPos); 
            doc.text(`: ${document.getElementById('nama_usaha').value}`, 80, yPos);
            yPos += lh;
            doc.text("Jenis Usaha", 30, yPos); 
            doc.text(`: ${document.getElementById('jenis_usaha').value}`, 80, yPos);
            yPos += lh;
            doc.text("Lokasi", 30, yPos); 
            doc.text(`: Desa Buareng`, 80, yPos);
        }
        else if (jenisSurat === 'pengantar') {
            yPos += 5;
            doc.text("Surat ini diberikan untuk keperluan:", 20, yPos);
            yPos += lh;
            const keperluan = document.getElementById('keperluan_pengantar').value;
            const kepSplit = doc.splitTextToSize(keperluan, 170);
            doc.text(kepSplit, 30, yPos);
            yPos += (kepSplit.length * lh);
        }
        else if (jenisSurat === 'sktm') {
            yPos += 5;
            const kepSKTM = document.getElementById('keperluan_sktm').value;
            doc.text(`Surat ini dibuat untuk keperluan: ${kepSKTM}`, 20, yPos);
            yPos += lh;
        }
        else if (jenisSurat === 'waris') {
            yPos += 5;
            doc.text("Adalah benar Ahli Waris dari Almarhum:", 20, yPos);
            yPos += lh;
            
            const namaAlm = document.getElementById('nama_alm').value;
            const tglMen = document.getElementById('tgl_meninggal').value;
            
            doc.text("Nama Almarhum", 30, yPos); doc.text(`: ${namaAlm}`, 80, yPos);
            yPos += lh;
            doc.text("Meninggal Tanggal", 30, yPos); doc.text(`: ${tglMen}`, 80, yPos);
        }

        // --- PENUTUP ---
        yPos += 10;
        doc.text("Demikian surat keterangan ini dibuat dengan sebenarnya untuk dipergunakan sebagaimana mestinya.", 20, yPos, {maxWidth: 170, align: "justify"});

        // --- TANDA TANGAN ---
        const today = new Date();
        const dateStr = today.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
        
        let yTTD = yPos + 20;
        
        // Cek halaman penuh
        if (yTTD > 250) { doc.addPage(); yTTD = 40; }

        doc.text(`Buareng, ${dateStr}`, 140, yTTD, null, null, "center");
        doc.text("Kepala Desa Buareng,", 140, yTTD + 7, null, null, "center");
        
        doc.setFont("times", "bold");
        doc.text(config.kades, 140, yTTD + 35, null, null, "center");
        doc.setLineWidth(0.5);
        doc.line(115, yTTD + 36, 165, yTTD + 36); // Garis bawah nama

        // --- SIMPAN FILE ---
        const fileName = `${jenisSurat.toUpperCase()}_${nama}.pdf`;
        doc.save(fileName);

        // --- KIRIM WA ---
        setTimeout(() => {
            const pesan = `Halo Pak Desa, saya *${nama}*.\nSaya telah mengisi form untuk *${judulSurat}*.\nFile PDF sudah saya unduh dan siap diprint. Mohon tanda tangannya.\nTerima kasih.`;
            window.open(`https://wa.me/${config.nomorWA}?text=${encodeURIComponent(pesan)}`, '_blank');
        }, 1000);
    }
</script>

</body>
</html>
